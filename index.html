<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mallu Dino</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    background:#f7f7f7;
    font-family:Arial;
    text-align:center;
}

#gameContainer{
    position:relative;
    width:100%;
    max-width:800px;
    height:300px;
    margin:20px auto;
    border-bottom:3px solid #444;
    overflow:hidden;
    background:white;
}

#dino{
    position:absolute;
    bottom:0;
    left:50px;
    width:60px;
}

#cactus{
    position:absolute;
    bottom:0;
    right:-60px;
    width:40px;
    height:60px;
    background:green;
}

#score{
    font-size:20px;
    margin-top:10px;
}

#gameOver{
    display:none;
    font-size:25px;
    color:red;
}

input{
    padding:8px;
    font-size:16px;
}

button{
    padding:8px 12px;
    font-size:16px;
    cursor:pointer;
}

#leaderboard{
    margin-top:20px;
}

.card{
    background:white;
    margin:5px auto;
    padding:10px;
    width:250px;
    border-radius:10px;
    box-shadow:0 2px 6px rgba(0,0,0,0.2);
    display:flex;
    justify-content:space-between;
}

#insta{
    margin-top:10px;
    display:inline-block;
    padding:8px 15px;
    background:#E1306C;
    color:white;
    border-radius:20px;
    text-decoration:none;
}
</style>
</head>

<body>

<h2>Mallu Dino</h2>

<input type="text" id="username" placeholder="Enter Username">
<button onclick="startGame()">âœ…</button>

<div id="gameContainer">
    <img id="dino" src="surya.png">
    <div id="cactus"></div>
</div>

<div id="score">Score: 0</div>
<div id="gameOver">Game Over ðŸ˜­ Press Space</div>

<a id="insta" href="https://www.instagram.com/i.wzieeeeeeeeeeeeeeeeeeeeeeeee?igsh=MTZqbXplNDY0b253Yw==" target="_blank">Instagram</a>

<h3>Leaderboard</h3>
<div id="leaderboard"></div>

<audio id="deathSound" src="ayoo.mp3"></audio>
<audio id="jumpSound" src="jump.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA9I4oU9khFGycZyIOvHcg3p6OrhSa1GzM",
  authDomain: "malludino-gg.firebaseapp.com",
  projectId: "malludino-gg",
  storageBucket: "malludino-gg.firebasestorage.app",
  messagingSenderId: "298331255490",
  appId: "1:298331255490:web:87440667c24a55c289c15b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let dino=document.getElementById("dino");
let cactus=document.getElementById("cactus");
let score=0;
let velocity=0;
let gravity=0.8;
let jumping=false;
let gameRunning=false;
let cactusSpeed=5;
let savedUsername="";

const deathSound=document.getElementById("deathSound");
const jumpSound=document.getElementById("jumpSound");

function startGame(){
    savedUsername=document.getElementById("username").value;
    if(savedUsername==="") return alert("Enter name");

    score=0;
    cactus.style.right="-60px";
    gameRunning=true;
    document.getElementById("gameOver").style.display="none";
    requestAnimationFrame(gameLoop);
}

function jump(){
    if(!jumping && gameRunning){
        velocity=-14;
        jumping=true;
        jumpSound.currentTime=0;
        jumpSound.play().catch(()=>{});
    }
}

document.addEventListener("keydown",e=>{
    if(e.code==="Space"){
        if(!gameRunning) startGame();
        jump();
    }
});

function gameLoop(){
    if(!gameRunning) return;

    velocity+=gravity;
    dino.style.bottom=(parseInt(dino.style.bottom||0)+velocity)+"px";

    if(parseInt(dino.style.bottom)<=0){
        dino.style.bottom="0px";
        jumping=false;
    }

    cactus.style.right=(parseInt(cactus.style.right)+cactusSpeed)+"px";

    if(parseInt(cactus.style.right)>900){
        cactus.style.right="-60px";
        score++;
        document.getElementById("score").innerText="Score: "+score;
    }

    // Collision
    if(parseInt(cactus.style.right)>650 && parseInt(dino.style.bottom)<50){
        endGame();
        return;
    }

    requestAnimationFrame(gameLoop);
}

async function endGame(){
    gameRunning=false;
    document.getElementById("gameOver").style.display="block";
    deathSound.currentTime=0;
    deathSound.play().catch(()=>{});
    await addDoc(collection(db,"scores"),{
        username:savedUsername,
        score:score
    });
    loadLeaderboard();
}

async function loadLeaderboard(){
    const q=query(collection(db,"scores"),orderBy("score","desc"),limit(5));
    const querySnapshot=await getDocs(q);
    let board=document.getElementById("leaderboard");
    board.innerHTML="";
    querySnapshot.forEach(doc=>{
        let data=doc.data();
        let div=document.createElement("div");
        div.className="card";
        div.innerHTML=`<span>${data.username}</span><span>${data.score}</span>`;
        board.appendChild(div);
    });
}

document.addEventListener("DOMContentLoaded",loadLeaderboard);
</script>

</body>
</html>
